<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter</title>
    <link rel="stylesheet" href="page.css">
</head>
<body>

    <div id="categoryFormContainer"></div>
    <div id="searchBarContainer"></div>
    <div class="products"></div>

    <script src="database.js"></script>
    <script>
        const productsContainer = document.querySelector('.products');
        data.forEach((product, index) => {
            const productCard = document.createElement('div');
            productCard.className = 'productCard';
            productCard.innerHTML = `
                <div class="product">
                    <img src="${product.img}" alt="${product.title}">
                    <h3>${product.title}</h3>
                    <p>${product.star} ${product.reviews}</p>
                    <p class="prevPrice">${product.prevPrice}</p>
                    <p>${product.newPrice}</p>
                    <p>Company: ${product.company}</p>
                    <p>Color: ${product.color}</p>
                </div>
            `;

            productsContainer.appendChild(productCard);

            if ((index + 1) % 3 === 0) {
                productCard.style.marginRight = '0';
            }
        });

        function includeSearchBar() {
            const searchBarContainer = document.getElementById('searchBarContainer');
            const searchbarRequest = new XMLHttpRequest();
            
            searchbarRequest.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    searchBarContainer.innerHTML = this.responseText;
                }
            };
            
            searchbarRequest.open('GET', 'SearchBar/searchBar.html', true);
            searchbarRequest.send();
        }

        function includeCategoryForm() {
            const categoryFormContainer = document.getElementById('categoryFormContainer');
            const categoryFormRequest = new XMLHttpRequest();
            
            categoryFormRequest.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    categoryFormContainer.innerHTML = this.responseText;
                    searchProducts();
                }
            };
            
            categoryFormRequest.open('GET', 'SideBar/category.html', true);
            categoryFormRequest.send();
        }

        function searchProducts() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();

            const categoryForm = document.getElementById('categoryForm');
            const selectedCategories = Array.from(categoryForm.querySelectorAll('input[name="category"]:checked')).map(checkbox => checkbox.value);

            const filteredProducts = data.filter(product =>
                (selectedCategories.length === 0 || selectedCategories.includes(product.category)) &&
                product.title.toLowerCase().includes(searchInput)
            );

            updateProducts(filteredProducts);
        }

        function updateProducts(filteredProducts) {
            const productsContainer = document.querySelector('.products');
            productsContainer.innerHTML = ''; 

            filteredProducts.forEach((product, index) => {
                const productCard = document.createElement('div');
                productCard.className = 'productCard';
                productCard.innerHTML = `
                    <div class="product">
                        <img src="${product.img}" alt="${product.title}">
                        <h3>${product.title}</h3>
                        <p>${product.star} ${product.reviews}</p>
                        <p class="prevPrice">${product.prevPrice}</p>
                        <p>${product.newPrice}</p>
                        <p>Company: ${product.company}</p>
                        <p>Color: ${product.color}</p>
                        <p>Catgeory: ${product.category}</p>
                    </div>
                `;

                productsContainer.appendChild(productCard);

                if ((index + 1) % 3 === 0) {
                    productCard.style.marginRight = '0';
                }
            });
        }

        includeCategoryForm();
        includeSearchBar();

        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', searchProducts);
        searchProducts();
    </script>
</body>
</html>
